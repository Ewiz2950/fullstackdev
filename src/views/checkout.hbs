<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../css/checkout.css">
<link rel="stylesheet" href="../js/checkout.js">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<p id="Header">Checkout page</p>
<div class="row">
  <div class="col-75">
    <div class="containeer">
      {{!-- When fom submitted, transport to here --}}
      <form id="form" method="GET" action="receipt" style="checkout.css">
      
        <div class="row">
          <div class="col-50">
            <h3>Billing Address</h3>
            {{!-- Name --}}
            <label for="name"><i class="fa fa-user"></i> Full Name*</label>
            <input class="form-control" type="text" placeholder="Example: Chia Kai Jun" id="name" required />

            <label for="email"><i class="fa fa-envelope"></i> Email*</label>
            <input class="form-control" type="email" id="email" placeholder="Example: john@example.com" required />
            
            <label for="adr"><i class="fa fa-address-card-o"></i> Address (Street, Block, Unit Number)*</label>
            <input class="form-control" type="text" id="adr" name="address" placeholder="Example: Ang Mo Kio Street 69, Blk106P, #07-212" required />

            <div class="row">
              <div class="col-50">
                <label for="zip">Zip*</label>
                <input class="form-control" 
                oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                {{!-- Javascript code needed here to prevent using text --}}
                pattern="\d*" minlength="6" maxlength="6" type="number" id="zip" name="zip" placeholder="Example: 123456" required />
              </div>
            </div>
          </div>
          <div class="col-50">
            <h3>Payment</h3>
            {{!-- Available credit cards to use with image --}}
            <label for="fname">Accepted Cards</label>
            <select class="form-select" id="card" name="card" required />
            <option value="">-- Select an option --</option>
            <option class="fa fa-cc-visa" value="Visa" style="color:blue;">Visa</option>
            <option class="fa fa-cc-mastercard" value="Mastercard" style="color:red;" value="Mastercard">Mastercard</option>
            </select>
            <div class="icon-container">
              <i class="fa fa-cc-visa" style="color:navy;"></i>
              <i class="fa fa-cc-mastercard" style="color:red;"></i>
            </div>
            
            <label for="cname">Name on Card*</label>
            <input class="form-control" type="text" id="cname" name="cname" required />
            
            <label for="ccnum">Credit card number*</label>
            <input class="form-control" 
            type="text" minlength="19" maxlength="19" id="ccnum" name="ccnum" placeholder="Example: 1111-2222-3333-4444" required />
                        
            <div class="row">
              <div class="col-50">
                <label for="expyear">Exp Month and Year*</label>
                <input class="form-control" type="month" id="expyear" name="expyear" required />
              </div>
              <div class="col-50">
                <label for="cvv">CVV*</label>
                <input class="form-control" oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
                type="password" id="cvv" name="cvv" pattern="\d*" minlength="3" maxlength="3" required />
              </div>
            </div>
          </div>
          
        </div>
        {{!-- Will link to thank you for purchase, but now link to base for testing --}}
        <button type="submit" class="btn btn-primary" onclick="submitForm()">Submit</button><span id="hi">* - Must be filled in</span>
    </div>
  </div>
  </form>
  <div class="col-25">
    <div class="container">
      <h4>Cart <span class="price" style="color:black"><i class="fa fa-shopping-cart"></i></span></h4>
      {{!-- Will be currently empty if nothing and have items if something there --}}
      <input class="form-control" type="text" id="item" name="item" value="Thinkpad Laptop" readonly></input>
      <img class="card-img-top p-5" src="/images/laptop.png" id="laptopimage">
      <hr>
      <h4>Total</h4>
      <input class="form-control" type="text" id="total" name="total" value="$100" style="color:black" readonly></input>
      {{!-- Will display nothing if there are no items and will compute total cost if there are items --}}
    </div>
  </div>
</div>
<script>
  if (window.openDatabase) {
    //Create the database the parameters are 1. the database name 2.version number 3. a description 4. the size of the database (in bytes) 1024 x 1024 = 1MB
    var mydb = openDatabase("cars_db", "0.1", "A Database of Cars I Like", 1024 * 1024);

    //create the cars table using SQL for the database using a transaction
    mydb.transaction(function (t) {
        t.executeSql("CREATE TABLE IF NOT EXISTS help (id INTEGER PRIMARY KEY ASC, name TEXT, email TEXT, adr TEXT, zip TEXT, card TEXT, cname TEXT, ccnum TEXT, expyear TEXT, cvv TEXT, item TEXT, total TEXT)");
    });
} else {
    alert("WebSQL is not supported by your browser!");
}
  function submitForm(){
    Insert();
    help();
  }
  function Insert(){
    if (mydb) {
        //get the values of the make and model text inputs
        var name = document.getElementById("name").value;
        var email = document.getElementById("email").value;
        var adr = document.getElementById("adr").value;
        var zip = document.getElementById("zip").value;
        var card = document.getElementById("card").value;
        var cname = document.getElementById("cname").value;
        var ccnum = document.getElementById("ccnum").value;
        var expyear = document.getElementById("expyear").value;
        var cvv = document.getElementById("cvv").value;
        var item = document.getElementById("item").value;
        var total = document.getElementById("total").value;

        //Test to ensure that the user has entered both a make and model
        if (name !== "" && email !== "") {
            //Insert the user entered details into the cars table, note the use of the ? placeholder, these will replaced by the data passed in as an array as the second parameter
            mydb.transaction(function (t) {
                t.executeSql("INSERT INTO help (name, email, adr, zip, card, cname, ccnum, expyear, cvv, item, total) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)", [name, email, adr, zip, card, cname, ccnum, expyear, cvv, item, total]);
            });
        } else {
            alert("There is a field left empty, try again!");
        }
    } else {
        alert("db not found, your browser does not support web sql!");
    }
  } 
  function help(){
    if(typeof(localStorage) != "undefined"){
        localStorage.name = document.getElementById("name").value;
        localStorage.email = document.getElementById("email").value;
        localStorage.adr = document.getElementById("adr").value;
        localStorage.zip = document.getElementById("zip").value;
        localStorage.cname = document.getElementById("cname").value;
        localStorage.ccnum = document.getElementById("ccnum").value;
        localStorage.expyear = document.getElementById("expyear").value;
        localStorage.card = document.getElementById("card").value;
        localStorage.item = document.getElementById("item").value;
        localStorage.total = document.getElementById("total").value;
    }
    document.getElementById("form").submit();
  }
</script>